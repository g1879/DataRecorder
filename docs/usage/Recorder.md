`Recorder`的功能简单直观高效实用，只做一个动作，就是不断接收数据，按顺序往文件末尾添加。可以接收单行数据，或二维数据一次写入多行。

支持 csv、xlsx、json、txt 四种格式文件。

## 🐘 创建对象

| 初始化参数        | 类型              | 默认值    | 说明                          |
|:------------:|:---------------:|:------:| --------------------------- |
| `path`       | `str`<br>`Path` | `None` | 文件路径，若不存在会自动创建，如存在则在最后追加数据。 |
| `cache_size` | `int`           | `None` | 要控制的标签页 id，为`None`则控制激活的标签页 |

**示例：**

```python
from DataRecorder import Recorder

r = Recorder(path='data.csv', cache_size=500)
```

---

## ➕ 添加数据

`Recorder`支持非常灵活的数据输入，可一次接收单条或多条数据。

- 接收`str`、`int`、`float`、openpyxl 的`Cell`对象，或其它类型对象时，将其作为一个数据独占一行来记录。

- 接收`list`、`tuple`、`dict`时，会将其中数据记录为一行。

- 接收二维`list`或`tuple`时，会记录为多行。

### ✔ 记录单个数据

```python
r.add_data('abc')  # 接收str数据
r.add_data(123)  # 接收int数据
r.add_data(cell)  # 接收openpyxl Cell对象（value为'def'）
```

!!! Tip "Tips"
    接收 openpyxl 的`Cell`对象时，会记录其`value`值。

文件内容：

```txt
abc
123
def
```

---

### ✔ 接收一行多个数据

```python
r.add_data({'a': 1, 'b': 2})  # 接收dict数据
r.add_data([123, 'abc'])  # 接收list数据
r.add_data((123, 'abc'))  # 接收tuple数据
```

!!! Tip "Tips"
    接收`dict`数据时，会记录其`value`值。如果一个新文件，接收的第一条数据是`dict`格式，会自动根据其`key`值创建表头。

文件内容：

| a   | b   |
| --- | --- |
| 1   | 2   |
| 123 | abc |
| 123 | abc |

---

### ✔ 接收多行数据

```python
r.add_data([{'a': 1, 'b': 2}, {'a': 3, 'b': 4}])  # 接收多个dict
r.add_data([(1, 2), (3, 4)])  # 接收二维list
r.add_data(((1, 2), (3, 4)))  # 接收二维tuple
```

其中，接收多个`dict`的数据时，如果是新建文件，会自动以`'a'`、`'b'`生成表头。

文件内容：

| a   | b   |
| --- | --- |
| 1   | 2   |
| 3   | 4   |
| 1   | 2   |
| 3   | 4   |
| 1   | 2   |
| 3   | 4   |

---

## 💾 写入文件

### ✍ 自动写入

当接收数据到达指定条数，或程序结束时，会触发写入文件动作，同时清空缓存。

如果写入时文件被打开而无法写入，会自动等待文件关闭再写入。

如果因其它问题导致写入失败，会返回收集到的数据，并打印到控制台。

在写入文件开始和结束时，默认会打印提示，提醒用户此时不要关闭进程。如须设置不显示，可把`show_msg`参数设置为`False`。

```python
from DataRecorder import Recorder

r = Recorder('data.csv')
r.add_data(123)  # 程序结束时自动写入文件
```

---

### ✍ 手动写入

可在程序中调用`record()`来提前执行写入动作。

```python
from DataRecorder import Recorder

r = Recorder('data.csv')
r.add_data(123)
r.record()  # 手动调用写入方法
```

---

### ⚠️ 注意事项

- 如果对象为全局对象，那么在使用 xlsx 或多线程写入的时候，退出自动记录功能会报错，须显式调用`record()`方法，或把记录器声明放在一个方法内。

- 切勿在文件正在写入的时候关闭进程，以免造成文件损坏。

- 强烈建议在程序结束时显式调用`record()`保存数据。

详见[《注意事项》](注意事项.md)一节。

---

## 📑 文件格式

`Recorder`支持 xlsx、csv、json、txt 四种记录格式。

- xlsx：表格文件，数据内容可保留类型。
- csv：表格文件，数据以文本方式记录。
- json：以 json 格式记录数据。
- txt：每行数据为文本格式，多个数据间用空格分隔。

### 🔖 自动识别文件格式

指定记录文件路径后，程序会根据文件后缀判断使用哪一种格式。

如果没有后缀或不是这四种之一，会以 csv 方式进行记录。

```python
r = Recorder('abc.csv')  # 自动以csv方式记录数据
```

---

### 🔖 手动指定文件格式

如果文件路径没有后缀，或想指定与后缀不一致的记录方式，可用`set.type()`指定记录格式。

```python
r = Recorder('abc')
r.set.type('csv')
```

---

### 💡 示例

有以下代码：

```python
data = (('姓名', '年龄'),
        ('张三', 20),
        ('李四', 22))
r.add_data(data)
```

**xlsx 格式保存内容：**

| 姓名  | 年龄  |
| --- | --- |
| 张三  | 20  |
| 李四  | 22  |

其中姓名列单元格格式为文本，年龄列单元格格式为数字。

**csv 格式保存内容：**

```csv
姓名,年龄
张三,20
李四,22
```

**json 格式保存内容：**

```json
[["\u59d3\u540d", "\u5e74\u9f84"], ["\u5f20\u4e09", 20], ["\u674e\u56db", 22]]
```

**txt 格式保存内容：**

```
姓名 年龄
张三 20
李四 22
```

---

## ♾️ `Recorder`对象的方法

### 📌 `add_data()`

此方法用于添加数据到缓存，可接收一个、一行或多行数据。

| 参数名称   | 类型    | 默认值 | 说明                                                   |
|:------:|:-----:|:---:| ---------------------------------------------------- |
| `data` | `Any` | 必填  | 可接收任意格式，接收一维`list`、`tuple`和`dict`时记录为一行，接收二维数据时记录为多行 |

返回：`None`

---

### 📌 `record()`

此方法用于把数据记录到文件，然后清空缓存。可把数据保存到一个新文件。

| 参数名称       | 类型              | 默认值    | 说明              |
|:----------:|:---------------:|:------:| --------------- |
| `new_path` | `str`<br>`Path` | `None` | 文件另存为的路径，会保存新文件 |

| 返回类型            | 说明                  |
|:---------------:|:-------------------:|
| `str`<br>`list` | 成功返回文件路径，失败返回未保存的数据 |

---

### 📌 `clear()`

此方法用于清空现有缓存。

参数：无

返回：`None`

---

## ⚙️ `Recorder`对象的参数设置

### 📌 `set.path()`

此方法用于设置文件路径，更改时会自动保存缓存数据到文件。

| 参数名称        | 类型              | 默认值    | 说明                   |
|:-----------:|:---------------:|:------:| -------------------- |
| `path`      | `str`<br>`Path` | 必填     | 文件路径                 |
| `file_type` | `str`           | `None` | 文件类型，为`None`则从文件名中获取 |

返回：`None`

---

### 📌 `set.cache_size()`

此方法用于设置缓存大小，指定采集多少条自动记录到文件，为`0`时不自动记录。

| 参数名称   | 类型    | 默认值 | 说明     |
|:------:|:-----:|:---:| ------ |
| `size` | `int` | 必填  | 缓存数据条数 |

返回：`None`

---

### 📌 `set.file_type()`

此方法用于指定文件类型，无视文件后缀名。

| 参数名称        | 类型    | 默认值 | 说明          |
|:-----------:|:-----:|:---:| ----------- |
| `file_type` | `str` | 必填  | 在四种支持的类型中选择 |

返回：`None`

---

### 📌 `set.table()`

此方法用于处理 xlsx 文件时指定数据表。

| 参数名称   | 类型    | 默认值 | 说明    |
|:------:|:-----:|:---:| ----- |
| `name` | `str` | 必填  | 数据表名称 |

返回：`None`

---

### 📌 `set.head()`

此方法用于给表格文件设置表头，只支持 csv 和 xlsx 格式文件。

| 参数名称   | 类型                | 默认值 | 说明   |
|:------:|:-----------------:|:---:| ---- |
| `head` | `list`<br>`tuple` | 必填  | 表头内容 |

返回：`None`

---

### 📌 `set.before()`

此方法用于设置对象`before`参数内容，设置前会先保存缓存数据。

`before`内容的用法将在 “进阶用法” 章节说明。

| 参数名称     | 类型    | 默认值 | 说明                      |
|:--------:|:-----:|:---:| ----------------------- |
| `before` | `Any` | 必填  | 每行数据前要添加的内容，单个数据或列表数据皆可 |

返回：`None`

---

### 📌 `set.after()`

此方法用于设置对象`after`参数内容，设置前会先保存缓存数据。

`after`内容的用法将在 “进阶用法” 章节说明。

| 参数名称    | 类型    | 默认值 | 说明                      |
|:-------:|:-----:|:---:| ----------------------- |
| `after` | `Any` | 必填  | 每行数据后要添加的内容，单个数据或列表数据皆可 |

返回：`None`

---

### 📌 `set.style()`

此方法用于设置新增数据的单元格格式，xlsx 格式时才生效。

| 参数名称    | 类型          | 默认值 | 说明           |
|:-------:|:-----------:|:---:| ------------ |
| `style` | `CellStyle` | 必填  | 用于设置单元格格式的对象 |

返回：`None`

---

### 📌 `set.col_height()`

此方法用于设置新增数据的行高，xlsx 格式时才生效。

| 参数名称     | 类型      | 默认值 | 说明  |
|:--------:|:-------:|:---:| --- |
| `height` | `float` | 必填  | 行高  |

返回：`None`

---

### 📌 `set.follow_styles()`

此方法用于设置新增数据的的样式和行高是否跟随文档最后一行，xlsx 格式时才生效。

| 参数名称     | 类型     | 默认值 | 说明            |
|:--------:|:------:|:---:| ------------- |
| `on_off` | `bool` | 必填  | `bool`类型表示开或关 |

返回：`None`

---

### 📌 `set.encoding()`

此方法用于设置编码格式，csv 格式时生效。

| 参数名称       | 类型    | 默认值 | 说明   |
|:----------:|:-----:|:---:| ---- |
| `encoding` | `str` | 必填  | 编码名称 |

返回：`None`

---

### 📌 `set.delimiter()`

此方法用于设置 csv 文件分隔符，csv 格式时才生效。

| 参数名称        | 类型    | 默认值 | 说明        |
|:-----------:|:-----:|:---:| --------- |
| `delimiter` | `str` | 必填  | csv 文件分隔符 |

返回：`None`

---

### 📌 `set.quote_char()`

此方法用于设置 csv 文件引用符，csv 格式时才生效。

| 参数名称         | 类型    | 默认值 | 说明        |
|:------------:|:-----:|:---:| --------- |
| `quote_char` | `str` | 必填  | csv 文件引用符 |

返回：`None`

---

### 📌 `set.show_msg()`

此方法用于设置是否显示运行信息。

| 参数名称     | 类型     | 默认值 | 说明            |
|:--------:|:------:|:---:| ------------- |
| `on_off` | `bool` | 必填  | `bool`类型表示开或关 |

返回：`None`

---

## 🔣 `Recorder`对象的属性

### 📌 `path`

此属性以字符串方式返回当前记录的文件路径。可赋值设置。更改时会自动保存缓存数据到文件。

**类型：**`str`

---

### 📌 `type`

此属性以字符串方式返回当前文件的类型。可赋值设置，即可无视文件后缀指定记录格式。

**类型：**`str`

---

### 📌 `data`

此属性以`list`方式返回当前保存在缓存里的数据。

**类型：**`list`

---

### 📌 `cache_size`

此属性返回缓存的大小，表示记录的条数。可赋值设置。

**类型：**`int`

---

### 📌 `table`

此属性返回当前处理的数据表，处理 xlsx 文件时才生效。

**类型：**`str`

---

### 📌 `encoding`

此属性返回当前文件的编码方式，默认为`'utf-8'`，可赋值设置。

**类型：**`str`

---

### 📌 `delimiter`

此属性返回 csv 文件使用的分隔符，默认为`','`，可赋值设置。

文件格式为 csv 时才生效。

**类型：**`str`

---

### 📌 `quote_char`

此属性返回csv 文件使用的引用符，默认为`'"'`，可赋值设置。

文件格式为 csv 时才生效。

**类型：**`str`

---

### 📌 `before`

此属性返回当前对象设置的`before`内容，`before`参数内容的用法将在 “进阶用法” 章节说明。

**类型：**`Any`

---

### 📌 `after`

此属性返回当前对象设置的`after`内容，`after`参数内容的用法将在 “进阶用法” 章节说明。

**类型：**`Any`

---

### 📌 `show_msg`

此属性用于设置是否打印程序运行时产生的提示信息。

**类型：**`bool`
